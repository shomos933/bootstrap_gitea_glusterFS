# bootstrap_gitea_glusterFS
Cоздание двух виртуалок в редхате через тераформ и установка на них Gitea 
через резервирование с помощью glusterFS. 
Создаём два виртуальных сервера с минимальным Debian‑образом 
(используя cloud‑init для первичной настройки, статических IP, DNS, проброса SSH‑ключа)
Автоматически настраиваем серверы через Ansible 
(общие настройки, отключение автообновлений, очистка кэша, настройка лог‑менеджмента, 
установка GlusterFS и Gitea)

1. Чтобы запустить просто выполнить данный скрипт master.sh
master.sh:
– Устанавливает пакеты.
– (Опционально) скачивает образ ОС, если его нет.
– Проверяет наличие пользователя "shom" и создает его, если нужно, а также настраивает домашний каталог и каталоги для образов и пула с правами 775.
– Создает пул libvirt «gitea_pool» в каталоге /home/shom/virsh_HDD, устанавливает права и SELinux‑контекст.
– Добавляет пользователя shom в группу libvirt.
– Запускает Terraform (идемпотентно, состояние хранится).
– Обновляет known_hosts (ssh-keyscan).
– Запускает Ansible playbook для дальнейшей настройки.

2. Чтобы удалить виртуалки, их пул и зачистить все после них выполнить cleaner.sh:
cleaner.sh:
– Удаляет виртуальные машины (destroy + undefine с опцией remove-all-storage).
– Останавливает и удаляет пул libvirt.
– (Опционально) удаляет файлы состояния Terraform.


project/
├── terraform/
│   ├── main.tf            # Конфигурация Terraform для создания ВМ с cloud-init
│   ├── variables.tf       # Объявление переменных (статические IP, имя пользователя и т.п.)
│   ├── outputs.tf         # Вывод созданных ресурсов (имена ВМ)
│   └── cloud-init.cfg     # Шаблон cloud-init для первичной настройки ВМ
├── ansible/
│   ├── inventory.ini      # Инвентори-файл с IP-адресами созданных ВМ
│   ├── playbook.yml       # Основной Ansible-плейбук, запускающий роли
│   └── roles/
│        ├── common/
│        │    └── tasks/
│        │         └── main.yml         # Задачи: обновление системы, установка утилит, настройка логов, отключение автообновлений, обновление known_hosts
│        │    └── files/
│        │         └── setup_log_management.sh  # Скрипт настройки логов
│        ├── glusterfs/
│        │    └── tasks/
│        │         └── main.yml         # Задачи по установке и настройке GlusterFS
│        └── gitea/
│             ├── tasks/
│             │    └── main.yml     # Задачи по установке и настройке Gitea
│             ├── files/
│             │    └── app.ini.backup 
│             │    └── gitea_data_backup.tar.gz
│             │    └── gitea_repos_backup.tar.gz
│             └── handlers/
│                       └── main.yml     # Хэндлер для перезапуска Gitea
└── master.sh             # Мастер-скрипт, выполняющий процесс (Terraform → Ansible)



